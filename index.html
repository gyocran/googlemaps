<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>LocateALL</title>
		<link rel="stylesheet" href="scripts/jquery.mobile-1.4.5.min.css"/>
		<script src="scripts/jquery-1.11.1.min.js"></script>
		<script src="scripts/jquery.mobile-1.4.5.min.js"></script>

		<style>
			#map {
			height: 1500px;
			width: 100%;
			}
			th {
			border-bottom: 1px solid #d6d6d6;
			}
			tr:nth-child(even) {
			background: #e9e9e9;
			}
		</style>
		<script>
			var map;
			var pos;
			var infoWindow;
			var placeName;
			var placeNumber;
			var placeRating;
			
			$(document).on("pagecreate", "#mappage", myMap);
			
			function myMap() {
				map = new google.maps.Map(document. getElementById('map'), {
				center: {lat: -34.397, lng: 150.644},
					zoom: 11,
					panControl: true,
					zoomControl: true,
					mapTypeControl: false,
					scaleControl: true,
					streetViewControl: true,
					overviewMapControl: true,
					rotateControl: true              
				});
				infoWindow = new google.maps.InfoWindow({map: map});
				var x = map.getCenter();
			// Try HTML5 geolocation.
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						pos = {
							lat: position.coords.latitude,
							lng: position.coords.longitude
						};
					infoWindow.setPosition(pos);
					infoWindow.setContent('You are here');
					map.setCenter(pos);
					} , showError); 
				} 
				else {
					handleLocationError(false, infoWindow, map.getCenter());
				}
			}

			function handleLocationError(browserHasGeolocation, infoWindow, pos) {
				infoWindow.setPosition(pos);
				infoWindow.setContent(browserHasGeolocation ?
				'Error: The Geolocation service failed.' :
				'Error: Your browser doesn\'t support geolocation.');
			}

			function findPlaces(place){
				<!-- var pyrmont = {lat: -33.867, lng: 151.195}; -->
				map = new google.maps.Map(document.getElementById('map'), {
					center: pos,
					zoom: 11
				});
				
				infowindow = new google.maps.InfoWindow();
				var service = new google.maps.places.PlacesService(map);
				service.nearbySearch({
					location: pos,
					radius: 10000,
					type: [place]
				}, callback);
			}

			function callback(results, status) {
				if (status === google.maps.places.PlacesServiceStatus.OK) {
					for (var i = 0; i < results.length; i++) {
						createMarker(results[i]);
					}
				}
			}

			function createMarker(place) {
				var placeLoc = place.geometry.location;
				var marker = new google.maps.Marker({
					map: map,
					position: place.geometry.location
				});

				google.maps.event.addListener(marker, 'click', function() {
					placeName = place.name;
					placeNumber = place.formatted_phone_number;
					placeRating = place.rating;
					infoWindow.setContent('<div><strong>' + place.name + '</strong><br>' +
						'Place ID: ' + place.place_id + '<br>' +
						'Place Address: ' + place.formatted_address + '<br>' + 
						'Place Telephone: ' + place.formatted_phone_number + '<br>' +
						'Place Website: ' + place.website + '<br>' +
						'Place Rating: ' + place.rating +
						'<a id="sendtosms" href="#smspage" class="ui-btn ui-icon-home ui-btn-icon-left" onclick=findPlaces("bank")>Send SMS</a>' +
						'</div>'
					);
					infoWindow.open(map, this);
					});
			}

			function placeSearch(){
				 var map = new google.maps.Map(document.getElementById('map'), {
					center: pos,
					zoom: 11,
				});
				var input = document.getElementById('pac-input');
				var searchBox = new google.maps.places.SearchBox(input);
				map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

				map.addListener('bounds_changed', function() {
					searchBox.setBounds(map.getBounds());
				});

				var markers = [];

				searchBox.addListener('place_changed', function() {
					var places = searchBox.getPlaces();

					if (places.length == 0) {
						return;
					}

					markers.forEach(function(marker) {
						marker.setMap(null);
						});
					markers = [];

					var bounds = new google.maps.LatLngBounds();
					places.forEach(function(place) {
						if (!place.geometry) {
							console.log("Returned place contains no geometry");
							return;
						}
						var icon = {
							url: place.icon,
							size: new google.maps.Size(71, 71),
							origin: new google.maps.Point(0, 0),
							anchor: new google.maps.Point(17, 34),
							scaledSize: new google.maps.Size(25, 25)
						};

						markers.push(new google.maps.Marker({
							map: map,
							icon: icon,
							title: place.name,
							position: place.geometry.location
						}));

						if (place.geometry.viewport) {
							// Only geocodes have viewport.
							bounds.union(place.geometry.viewport);
						} else {
							bounds.extend(place.geometry.location);
						}
					});
						map.fitBounds(bounds);
				});
			}	

			function getUserLocation(position){
				if(myCenter===undefined){
					alert("undef");
				}
				myCenter = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
				return 
						<!-- myCenter = { -->
						<!-- lat: position.coords.latitude, -->
						<!-- lng: position.coords.longitude -->
						<!-- }; -->
			}

						//remember to make infowindow display these 
			function showError(error) {
				switch(error.code) {
					case error.PERMISSION_DENIED:
					alert("User denied the request for Geolocation.");
					break;
					case error.POSITION_UNAVAILABLE:
					alert("Location information is unavailable.");
					break;
					case error.TIMEOUT:
					alert("The request to get user location timed out.");
					break;
					case error.UNKNOWN_ERROR:
					alert("An unknown error occurred.");
					break;
					}
			}
						<!-- else { -->
						<!-- // Browser doesn't support Geolocation -->
						<!-- handleLocationError(false, infoWindow, map.getCenter()); -->
						<!-- }		 -->
		</script>
	</head>
	<body>
	<div data-role="page" id="landingPage" data-theme="a">
		<div data-role="header">
			<h1>LocateALL</h1>
			<!-- <a href="index.html" data-role="button" data-icon="home" data-iconpos="notext" style="background: white;background-color:darkgrey;border: none;">Home</a> -->
		</div><!-- /header -->
		</br>
		<center><img src="images/landing.jpg" style="height: 150px; margin: auto"></center>
		<div data-role="content" style="text-shadow: none;">
			<div id="login">
				<div style = "color:red" id = "errorMsg"> </div>
					<input type="text" placeholder="username" id="username" name = "username">
					<input type="password" placeholder="password" id="password" name = "pword">
					<input type="submit" id="loginbutton" value="Sign In">
				</div>
					<a href="#registerPage" data-transition="pop">
						<button>Register</button>
					</a>
		</div><!-- /content -->
	</div><!-- /page -->
							

	<div data-role="page" id="registerPage" data-theme="a">
								<div data-role="header" style="text-shadow: none">
									<h1>LocateALL</h1>
									<a href="index.html" data-role="button" data-icon="back" data-iconpos="notext" style="background: white;background-color:darkgrey;border: none;
											">Home</a>
								</div><!-- /header -->
								<div data-role="content" style="text-shadow: none">
									<form id="addUserForm" action="" method="GET" >
										<div class="form-group">
											<label for="Username">Username</label>
											<input type="text" class="form-control" id="reg_username" placeholder="Username">
											</div>
											<div class="form-group">
												<label for="First Name">First Name</label>
												<input type="text" class="form-control" id="reg_firstname" placeholder="First Name">
												</div>
												<div class="form-group">
													<label for="Last Name">Last Name</label>
													<input type="text" class="form-control" id="reg_lastname" placeholder="Last Name">
													</div>
													<div class="form-group">
														<label for="Telephone">Telephone Number</label>
														<input type="text" class="form-control" id="reg_telephone" placeholder="Telephone Number">
														</div>
														<div class="form-group">
															<label for="Password">Password</label>
															<input type="password" class="form-control" id="reg_password" placeholder="Password">
															</div>

															<button id="newUser" type="submit" class="btn btn-default">Submit</button>
														</form>
													</div><!-- /content -->
												</div><!-- /page -->
	
	<div data-role="page" id="mappage" data-theme="a">
		<div data-role="panel" id="menu" data-theme="b"> 
			<center><h2>Places</h2></center>
			<a href="#" class="ui-btn ui-icon-home ui-btn-icon-left" onclick=findPlaces("bank")>Bank</a>
			<a href="#" class="ui-btn ui-icon-home ui-btn-icon-left" onclick=findPlaces("atm")>ATM</a>
			<a href="#" class="ui-btn ui-icon-home ui-btn-icon-left" onclick=findPlaces("hotel")>Hotel</a>
		</div> 
	
		<div data-role="header">
			<h1 data-inline="true"></h1>
			<div class="ui-btn-right">
				<a class="ui-btn ui-corner-all ui-icon-phone  ui-btn-icon-notext ui-alt-icon ui-nodisc-icon" id="contacts">Contacts</a>
				<a href="#menu" class="ui-btn ui-corner-all ui-icon-bars  ui-btn-icon-notext ui-alt-icon ui-nodisc-icon">Menu</a>
				<a href="#" id="refresh" class="ui-btn ui-corner-all ui-icon-refresh  ui-btn-icon-notext ui-alt-icon ui-nodisc-icon">Refresh</a>
			</div>
		</div>
		<div data-role="content">
			<div id="map">
			</div>
		</div>
	</div>

	<div data-role="page" id="contactspage" data-theme="a">
		<div data-role="header">
				<h2>Contacts</h2>
		</div>
		<div data-role="content">
			<div id="contacts">
			</div>
		</div>
	</div>
	
	<div data-role="page" id="adminpage" data-theme="a">
		<div data-role="header">
												<!-- <h1 data-inline="true"></h1> -->
			<h1>Welcome, <span id="adminname"></span></h1>										
		</div>
														<!-- </br> -->
		<div data-role="content">												
			<table id="userstable" data-role="table" class="ui-responsive ui-shadow">
				<thead></thead>
				<tbody></tbody>
			</table>
		</div>
		<div data-role="footer" style="text-align:center;">
			<a href="#" id="getusers" class="ui-btn ui-icon-plus ui-btn-icon-left">Retrieve Users</a>
			<!-- <a href="#" class="ui-btn ui-icon-plus ui-btn-icon-left">Enable User</a> -->
			<a href="#enabledisablepage" class="ui-btn ui-icon-plus ui-btn-icon-left">Enable or Disable User</a>
			<a href="#mappage" class="ui-btn ui-icon-plus ui-btn-icon-left">Show Map</a>
		</div>
	</div>
													
	<div data-role="popup" id="enabledisablepage" data-theme="a">
		<div data-role="header">
					<!-- <h1 data-inline="true"></h1> -->
		<h3>Disable user</h3>
		</div>
		
		<div data-role="content">
			<div class="form-group">
				<label for="User Id">ID</label>
				<input type="text" class="form-control" id="user_id" placeholder="Id">
			</div>
			
			<button id="disablebutton" type="submit" class="btn btn-default">Disable</button>
			<button id="enablebutton" type="submit" class="btn btn-default">Enable</button>
		</div>
	</div>													
													
	<div data-role="page" id="smspage" data-theme="a">
		<div data-role="header">
			<h1>LocateALL</h1>
			<a href="#mappage" data-role="button" data-icon="home" data-iconpos="notext" style="background: white;background-color:darkgrey;border: none;">Home</a>
		</div><!-- /header -->
		<div data-role="content">
			<p></p>
            <div id="status">
			</div>
            <div class="form-group">
                <label>Place Name</label>
                <p id="placename"><script>document.getElementById("placename").innerHTML = placeName</script></p>
            </div>
            <div class="form-group">
                <label>Number:</label>
                <input class="form-control" type="tel" name="phoneNumber" id="phoneNumb" placeholder="eg. 233244444444"><br>
            </div>
            <div class="form-group">
                <label>Sender:</label>
                <input class="form-control" type="text" name="senderName" id="sender" placeholder="eg. Sydney Dean"><br>
            </div>
            <div class="form-group">
                <label>Select Message:</label>
                <select class="form-control" name="autoMsg">
                    <option value="1">Book a room</option>
                    <option value="2">Request ATM</option>
                </select>
				<br>
            </div>
            <div class="form-group">
                <label>Message:</label>
                <textarea class="form-control" name="message" id="msg"></textarea>
            </div>
            <br>
            <br>
            <div class="form-group">
                <input id="submit" type="Submit" value="SEND">
            </div>
        </div>
	</div>
												
	</body>
	<script src="scripts/cordova.js"></script>
	<script src="scripts/index.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCr6kVcZzjqmLOVGc4n_XrOhIR8QXo4bdw&libraries=places"
	></script>
	<!-- &callback=myMap" -->
</html>